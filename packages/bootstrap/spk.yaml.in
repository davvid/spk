# use a low version and explicit bootstrap tag to be clear
pkg: NAME/0.0.0+bootstrap.1
api: v0/package

sources: [] # no source package files

build:
  # this is an empty package which just assumes that NAME is installed and
  # available to be used, hence the bootstrapping idea...
  # Usually this package is only used to satisfy the dependencies of the
  # real NAME package which requires itself to build itself
  options:
    - var: arch
    - var: os
    - var: distro
    - var: centos
    - pkg: stdfs
    - var: bootstrapped/yes
      inheritance: Strong
      description: >
        this package or a dependency was generated by bootstrapping a
        system package and may not work on other hosts
  script: |
    if ( test -d /etc/yum.repos.d || test -d /etc/dnf ) && rpm -q NAME
    then
      files="$(rpm -ql NAME | grep -v -E '/doc/|/man/')"
    elif test -d /etc/apt && test -d /usr/share/doc/NAME
    then
      files="$(dpkg -L NAME | grep -v -E '/doc/|/man/')"
    else
      echo "NAME is not installed on this system"
      exit 1
    fi
    mkdir -p /spfs/share/aclocal
    for file in $files
    do
      test -f "${file}" || continue
      newfile="/spfs/${file#/usr/}"
      mkdir -p "$(dirname "${newfile}")"
      cp --preserve=mode,timestamps "${file}" "${newfile}"
    done

install:
  requirements:
    - pkg: stdfs
